{"version":3,"file":"traversalCache.js","names":["_traverse","_interopRequireDefault","require","obj","__esModule","default","caches","WeakMap","getTraversalCache","path","name","programPath","find","p","isProgram","Error","node","type","has","set","Map","cache","get","exports","traverseCache","traverse","clearBabelTraversalCache","clear","invalidateTraversalCache","delete"],"sources":["../src/traversalCache.ts"],"sourcesContent":["import type { NodePath } from '@babel/traverse';\nimport traverse from '@babel/traverse';\nimport type { Node } from '@babel/types';\n\nconst caches = new WeakMap<\n  NodePath,\n  Map<string, WeakMap<NodePath | Node, unknown>>\n>();\n\nexport const getTraversalCache = <\n  TValue,\n  TKey extends NodePath | Node = NodePath,\n>(\n  path: NodePath,\n  name: string\n) => {\n  const programPath = path.find((p) => p.isProgram());\n  if (!programPath) {\n    throw new Error(`Could not find program for ${path.node.type}`);\n  }\n\n  if (!caches.has(programPath)) {\n    caches.set(programPath, new Map());\n  }\n\n  const cache = caches.get(programPath)!;\n  if (!cache.has(name)) {\n    cache.set(name, new WeakMap());\n  }\n\n  return cache.get(name) as WeakMap<TKey, TValue>;\n};\n\nconst traverseCache = (traverse as unknown as { cache: unknown }).cache;\nexport const clearBabelTraversalCache = () => {\n  (traverseCache as { clear: () => void }).clear();\n};\n\nexport const invalidateTraversalCache = (path: NodePath) => {\n  const programPath = path.find((p) => p.isProgram());\n  if (!programPath) {\n    throw new Error(`Could not find program for ${path.node.type}`);\n  }\n\n  caches.delete(programPath);\n};\n"],"mappings":";;;;;;AACA,IAAAA,SAAA,GAAAC,sBAAA,CAAAC,OAAA;AAAuC,SAAAD,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAGvC,MAAMG,MAAM,GAAG,IAAIC,OAAO,CAGxB,CAAC;AAEI,MAAMC,iBAAiB,GAAGA,CAI/BC,IAAc,EACdC,IAAY,KACT;EACH,MAAMC,WAAW,GAAGF,IAAI,CAACG,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC;EACnD,IAAI,CAACH,WAAW,EAAE;IAChB,MAAM,IAAII,KAAK,CAAE,8BAA6BN,IAAI,CAACO,IAAI,CAACC,IAAK,EAAC,CAAC;EACjE;EAEA,IAAI,CAACX,MAAM,CAACY,GAAG,CAACP,WAAW,CAAC,EAAE;IAC5BL,MAAM,CAACa,GAAG,CAACR,WAAW,EAAE,IAAIS,GAAG,CAAC,CAAC,CAAC;EACpC;EAEA,MAAMC,KAAK,GAAGf,MAAM,CAACgB,GAAG,CAACX,WAAW,CAAE;EACtC,IAAI,CAACU,KAAK,CAACH,GAAG,CAACR,IAAI,CAAC,EAAE;IACpBW,KAAK,CAACF,GAAG,CAACT,IAAI,EAAE,IAAIH,OAAO,CAAC,CAAC,CAAC;EAChC;EAEA,OAAOc,KAAK,CAACC,GAAG,CAACZ,IAAI,CAAC;AACxB,CAAC;AAACa,OAAA,CAAAf,iBAAA,GAAAA,iBAAA;AAEF,MAAMgB,aAAa,GAAIC,iBAAQ,CAAmCJ,KAAK;AAChE,MAAMK,wBAAwB,GAAGA,CAAA,KAAM;EAC3CF,aAAa,CAA2BG,KAAK,CAAC,CAAC;AAClD,CAAC;AAACJ,OAAA,CAAAG,wBAAA,GAAAA,wBAAA;AAEK,MAAME,wBAAwB,GAAInB,IAAc,IAAK;EAC1D,MAAME,WAAW,GAAGF,IAAI,CAACG,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC;EACnD,IAAI,CAACH,WAAW,EAAE;IAChB,MAAM,IAAII,KAAK,CAAE,8BAA6BN,IAAI,CAACO,IAAI,CAACC,IAAK,EAAC,CAAC;EACjE;EAEAX,MAAM,CAACuB,MAAM,CAAClB,WAAW,CAAC;AAC5B,CAAC;AAACY,OAAA,CAAAK,wBAAA,GAAAA,wBAAA"}