{"version":3,"file":"removeDangerousCode.test.js","names":["_core","require","_generator","_interopRequireDefault","_traverse","_dedent","_removeDangerousCode","obj","__esModule","default","run","code","ast","parseSync","dedent","filename","presets","Error","traverse","Program","path","removeDangerousCode","generate","describe","it","expect","toBeDefined","result","toMatchSnapshot"],"sources":["../../src/__tests__/removeDangerousCode.test.ts"],"sourcesContent":["import { parseSync } from '@babel/core';\nimport generate from '@babel/generator';\nimport traverse from '@babel/traverse';\nimport dedent from 'dedent';\n\nimport { removeDangerousCode } from '../removeDangerousCode';\n\nconst run = (code: TemplateStringsArray) => {\n  const ast = parseSync(dedent(code), {\n    filename: 'test.tsx',\n    presets: ['@babel/preset-typescript', '@babel/preset-react'],\n  });\n\n  if (!ast) {\n    throw new Error('Failed to parse');\n  }\n\n  traverse(ast, {\n    Program(path) {\n      removeDangerousCode(path);\n    },\n  });\n\n  return generate(ast).code;\n};\n\ndescribe('removeDangerousCode', () => {\n  it('should be defined', () => {\n    expect(removeDangerousCode).toBeDefined();\n  });\n\n  it('should remove `window` but keep `setVersion` function untouched', () => {\n    const result = run`\n      let _win = undefined;\n\n      try {\n        _win = window;\n      } catch (e) {\n        /* no-op */\n      }\n      export function setVersion(packageName, packageVersion) {\n        if (typeof _win !== 'undefined') {\n          return null;\n        }\n      }\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n\n  it('should replace body of react component with null', () => {\n    const result = run`\n      export var Popup = /*#__PURE__*/function () {\n        var Popup = function Popup() {\n          var name = Popup.displayName;\n          return <div>{name}</div>;\n        };\n\n        Popup.displayName = 'Popup';\n\n        return Popup;\n      }();\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n\n  it('should simplify ternary operator', () => {\n    expect(run`\n      export function getHostname(opts) {\n        return typeof location !== \"undefined\" ? location.hostname : \"localhost\";\n      }\n    `).toMatchSnapshot();\n\n    expect(run`\n      export function getHostname(opts) {\n        return location.hostname ? \"location.hostname\" : \"localhost\";\n      }\n    `).toMatchSnapshot();\n\n    expect(run`\n      export function getHostname(opts) {\n        return opts ? \"localhost\" : location.hostname;\n      }\n    `).toMatchSnapshot();\n\n    expect(run`\n      export function getHostname(opts) {\n        return opts ? location.hostname : \"localhost\";\n      }\n    `).toMatchSnapshot();\n  });\n\n  it('should simplify OR expression', () => {\n    const result = run`\n      export function getHostname(opts) {\n        return opts.hostname || location.hostname;\n      }\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n\n  it('should remove code under is-it-browser checks', () => {\n    const result = run`\n      let method;\n\n      if (typeof window !== 'undefined') {\n        console.log('it is browser');\n        method = window.fetch;\n      }\n\n      if (typeof window === 'undefined') {\n        console.log('it is not browser');\n        method = fetch;\n      }\n\n      export function testFn(arg) {\n        method(arg);\n      }\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n\n  it('should simplify if statement', () => {\n    const result = run`\n      if (typeof window !== 'undefined') {\n        console.log('it is browser');\n      }\n\n      if (typeof window === 'undefined') {\n        console.log('it is not browser');\n      }\n\n      if (typeof window === 'undefined') {\n        console.log('it is not browser');\n      } else {\n        console.log('it is browser');\n      }\n\n      if (typeof window !== 'undefined') {\n        console.log('it is browser');\n      } else {\n        console.log('it is not browser');\n      }\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n\n  it('should not remove class', () => {\n    const result = run`\n      class Test {\n        constructor() {\n          window.fetch();\n        }\n      }\n    `;\n\n    expect(result).toMatchSnapshot();\n  });\n});\n"],"mappings":"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"}