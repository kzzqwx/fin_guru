{"version":3,"file":"perfMetter.js","names":["path","EventEmitter","isOnActionStartArgs","formatTime","timestamps","date","Date","performance","timeOrigin","toLocaleTimeString","getMilliseconds","toString","padStart","workingDir","process","cwd","replacer","_key","value","isAbsolute","relative","Map","Array","from","entries","reduce","obj","k","v","key","printTimings","timings","startedAt","sourceRoot","size","console","log","now","toFixed","forEach","label","byLabel","array","sort","a","b","localeCompare","time","name","startsWith","printActions","actions","actionsIdx","Set","actionsByType","actionsByEntrypoint","getIdx","action","idx","split","add","has","type","set","get","entrypointRef","slice","entrypoint","createPerfMeter","options","emitter","dummy","onDone","addTiming","forLabel","Math","round","processedDependencies","processDependencyEvent","file","only","imports","fileIdx","exports","passes","processed","processSingleEvent","meta","startTimes","onEvent","Object","startTime","String","onAction","args","timestamp","id","length","push","result","isAsync","error","finishedAt","print","memoryUsage","filename","fs","require","writeFileSync","JSON","stringify","map","duration","clear"],"sources":["../../src/debug/perfMetter.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport path from 'path';\n\nimport type {\n  OnAction,\n  OnEvent,\n  OnActionFinishArgs,\n  OnActionStartArgs,\n} from '../EventEmitter';\nimport { EventEmitter, isOnActionStartArgs } from '../EventEmitter';\n\ntype Timings = Map<string, Map<string, number>>;\n\nexport interface IPerfMeterOptions {\n  filename?: string;\n  print?: boolean;\n}\n\ninterface IProcessedDependency {\n  exports: string[];\n  fileIdx: string;\n  imports: { from: string; what: string[] }[];\n  passes: number;\n}\n\nexport interface IProcessedEvent {\n  file: string;\n  fileIdx: string;\n  imports: { from: string; what: string[] }[];\n  only: string[];\n  type: 'dependency';\n}\n\nexport interface IQueueActionEvent {\n  action: string;\n  args?: string[];\n  datetime: Date;\n  file: string;\n  queueIdx: string;\n  type: 'queue-action';\n}\n\ninterface IAction {\n  entrypointRef: string;\n  error?: unknown;\n  finishedAt?: number;\n  idx: string;\n  isAsync?: boolean;\n  result?: 'finished' | 'failed';\n  startedAt: number;\n  type: string;\n}\n\nconst formatTime = (timestamps: number | undefined) => {\n  if (!timestamps) {\n    return 'unfinished';\n  }\n\n  const date = new Date(performance.timeOrigin + timestamps);\n  return `${date.toLocaleTimeString()}.${date\n    .getMilliseconds()\n    .toString()\n    .padStart(3, '0')}`;\n};\n\nconst workingDir = process.cwd();\n\nfunction replacer(_key: string, value: unknown): unknown {\n  if (typeof value === 'string' && path.isAbsolute(value)) {\n    return path.relative(workingDir, value);\n  }\n\n  if (value instanceof Map) {\n    return Array.from(value.entries()).reduce((obj, [k, v]) => {\n      const key = replacer(k, k) as string;\n      return {\n        ...obj,\n        [key]: replacer(key, v),\n      };\n    }, {});\n  }\n\n  return value;\n}\n\nfunction printTimings(timings: Timings, startedAt: number, sourceRoot: string) {\n  if (timings.size === 0) {\n    return;\n  }\n\n  console.log(`\\nTimings:`);\n  console.log(`  Total: ${(performance.now() - startedAt).toFixed()}ms`);\n\n  Array.from(timings.entries()).forEach(([label, byLabel]) => {\n    console.log(`\\n  By ${label}:`);\n\n    const array = Array.from(byLabel.entries());\n    // array.sort(([, a], [, b]) => b - a);\n    array\n      .sort(([a], [b]) => a.localeCompare(b))\n      .forEach(([value, time]) => {\n        const name = value.startsWith(sourceRoot)\n          ? path.relative(sourceRoot, value)\n          : value;\n        console.log(`    ${name}: ${time}ms`);\n      });\n  });\n}\n\nfunction printActions(actions: IAction[]) {\n  const actionsIdx = new Set<string>();\n  const actionsByType = new Map<string, Set<string>>();\n  const actionsByEntrypoint = new Map<string, Set<string>>();\n\n  const getIdx = (action: IAction) => action.idx.split(':')[0];\n\n  actions.forEach((action) => {\n    actionsIdx.add(getIdx(action));\n\n    if (!actionsByType.has(action.type)) {\n      actionsByType.set(action.type, new Set());\n    }\n\n    actionsByType.get(action.type)!.add(getIdx(action));\n\n    if (!actionsByEntrypoint.has(action.entrypointRef)) {\n      actionsByEntrypoint.set(action.entrypointRef, new Set());\n    }\n\n    actionsByEntrypoint.get(action.entrypointRef)!.add(getIdx(action));\n  });\n\n  console.log('\\nActions:');\n  console.log(`  Total: ${actionsIdx.size}`);\n  console.log(`  By type:`);\n  Array.from(actionsByType.entries())\n    .sort(([, a], [, b]) => b.size - a.size)\n    .forEach(([type, set]) => {\n      console.log(`    ${type}: ${set.size}`);\n    });\n  console.log(`  By entrypoint (top 10):`);\n  Array.from(actionsByEntrypoint.entries())\n    .sort(([, a], [, b]) => b.size - a.size)\n    .slice(0, 10)\n    .forEach(([entrypoint, set]) => {\n      console.log(`    ${entrypoint}: ${set.size}`);\n    });\n}\n\nexport const createPerfMeter = (\n  options: IPerfMeterOptions | boolean = true\n) => {\n  if (!options) {\n    return {\n      emitter: EventEmitter.dummy,\n      onDone: () => {},\n    };\n  }\n\n  const startedAt = performance.now();\n  const timings: Timings = new Map();\n  const addTiming = (label: string, key: string, value: number) => {\n    if (!timings.has(label)) {\n      timings.set(label, new Map());\n    }\n\n    const forLabel = timings.get(label)!;\n    forLabel.set(key, Math.round((forLabel.get(key) || 0) + value));\n  };\n\n  const processedDependencies = new Map<string, IProcessedDependency>();\n  const processDependencyEvent = ({\n    file,\n    only,\n    imports,\n    fileIdx,\n  }: IProcessedEvent) => {\n    if (!processedDependencies.has(file)) {\n      processedDependencies.set(file, {\n        exports: [],\n        imports: [],\n        passes: 0,\n        fileIdx,\n      });\n    }\n\n    const processed = processedDependencies.get(file)!;\n    processed.passes += 1;\n    processed.exports = only;\n    processed.imports = imports;\n  };\n\n  const processSingleEvent = (\n    meta: Record<string, unknown> | IProcessedEvent | IQueueActionEvent\n  ) => {\n    if (meta.type === 'dependency') {\n      processDependencyEvent(meta as IProcessedEvent);\n    }\n  };\n\n  const startTimes = new Map<string, number>();\n\n  const onEvent: OnEvent = (meta, type) => {\n    if (type === 'single') {\n      processSingleEvent(meta);\n      return;\n    }\n\n    if (type === 'start') {\n      Object.entries(meta).forEach(([label, value]) => {\n        startTimes.set(`${label}\\0${value}`, performance.now());\n      });\n    } else {\n      Object.entries(meta).forEach(([label, value]) => {\n        const startTime = startTimes.get(`${label}\\0${value}`);\n        if (startTime) {\n          addTiming(label, String(value), performance.now() - startTime);\n        }\n      });\n    }\n  };\n\n  const actions: IAction[] = [];\n\n  const onAction: OnAction = (\n    ...args: OnActionStartArgs | OnActionFinishArgs\n  ) => {\n    if (isOnActionStartArgs(args)) {\n      const [, timestamp, type, idx, entrypointRef] = args;\n      const id = actions.length;\n      actions.push({\n        entrypointRef,\n        idx,\n        startedAt: timestamp,\n        type,\n      });\n\n      return id;\n    }\n\n    const [result, timestamp, id, isAsync, error] = args;\n    actions[id].error = error;\n    actions[id].finishedAt = timestamp;\n    actions[id].isAsync = isAsync;\n    actions[id].result = `${result}ed`;\n\n    addTiming(\n      'actions',\n      `${isAsync ? 'async' : 'sync'} ${actions[id].type}`,\n      timestamp - actions[id].startedAt\n    );\n\n    return id;\n  };\n\n  const emitter = new EventEmitter(onEvent, onAction, () => {});\n\n  return {\n    emitter,\n    onDone: (sourceRoot: string) => {\n      if (options === true || options.print) {\n        printTimings(timings, startedAt, sourceRoot);\n\n        console.log(\n          '\\nNumber of processed dependencies:',\n          processedDependencies.size\n        );\n\n        printActions(actions);\n\n        console.log('\\nMemory usage:', process.memoryUsage());\n      }\n\n      if (options !== true && options.filename) {\n        const fs = require('fs');\n        fs.writeFileSync(\n          options.filename,\n          JSON.stringify(\n            {\n              processedDependencies,\n              actions: actions.map(({ finishedAt, ...action }) => ({\n                ...action,\n                duration: finishedAt\n                  ? finishedAt - action.startedAt\n                  : 'unfinished',\n                startedAt: formatTime(action.startedAt),\n              })),\n              timings,\n            },\n            replacer,\n            2\n          )\n        );\n      }\n\n      actions.length = 0;\n      timings.clear();\n      processedDependencies.clear();\n    },\n  };\n};\n"],"mappings":"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"}