{"version":3,"file":"traversalCache.js","names":["traverse","caches","WeakMap","getTraversalCache","path","name","programPath","find","p","isProgram","Error","node","type","has","set","Map","cache","get","traverseCache","clearBabelTraversalCache","clear","invalidateTraversalCache","delete"],"sources":["../src/traversalCache.ts"],"sourcesContent":["import type { NodePath } from '@babel/traverse';\nimport traverse from '@babel/traverse';\nimport type { Node } from '@babel/types';\n\nconst caches = new WeakMap<\n  NodePath,\n  Map<string, WeakMap<NodePath | Node, unknown>>\n>();\n\nexport const getTraversalCache = <\n  TValue,\n  TKey extends NodePath | Node = NodePath,\n>(\n  path: NodePath,\n  name: string\n) => {\n  const programPath = path.find((p) => p.isProgram());\n  if (!programPath) {\n    throw new Error(`Could not find program for ${path.node.type}`);\n  }\n\n  if (!caches.has(programPath)) {\n    caches.set(programPath, new Map());\n  }\n\n  const cache = caches.get(programPath)!;\n  if (!cache.has(name)) {\n    cache.set(name, new WeakMap());\n  }\n\n  return cache.get(name) as WeakMap<TKey, TValue>;\n};\n\nconst traverseCache = (traverse as unknown as { cache: unknown }).cache;\nexport const clearBabelTraversalCache = () => {\n  (traverseCache as { clear: () => void }).clear();\n};\n\nexport const invalidateTraversalCache = (path: NodePath) => {\n  const programPath = path.find((p) => p.isProgram());\n  if (!programPath) {\n    throw new Error(`Could not find program for ${path.node.type}`);\n  }\n\n  caches.delete(programPath);\n};\n"],"mappings":"AACA,OAAOA,QAAQ,MAAM,iBAAiB;AAGtC,MAAMC,MAAM,GAAG,IAAIC,OAAO,CAGxB,CAAC;AAEH,OAAO,MAAMC,iBAAiB,GAAGA,CAI/BC,IAAc,EACdC,IAAY,KACT;EACH,MAAMC,WAAW,GAAGF,IAAI,CAACG,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC;EACnD,IAAI,CAACH,WAAW,EAAE;IAChB,MAAM,IAAII,KAAK,CAAE,8BAA6BN,IAAI,CAACO,IAAI,CAACC,IAAK,EAAC,CAAC;EACjE;EAEA,IAAI,CAACX,MAAM,CAACY,GAAG,CAACP,WAAW,CAAC,EAAE;IAC5BL,MAAM,CAACa,GAAG,CAACR,WAAW,EAAE,IAAIS,GAAG,CAAC,CAAC,CAAC;EACpC;EAEA,MAAMC,KAAK,GAAGf,MAAM,CAACgB,GAAG,CAACX,WAAW,CAAE;EACtC,IAAI,CAACU,KAAK,CAACH,GAAG,CAACR,IAAI,CAAC,EAAE;IACpBW,KAAK,CAACF,GAAG,CAACT,IAAI,EAAE,IAAIH,OAAO,CAAC,CAAC,CAAC;EAChC;EAEA,OAAOc,KAAK,CAACC,GAAG,CAACZ,IAAI,CAAC;AACxB,CAAC;AAED,MAAMa,aAAa,GAAIlB,QAAQ,CAAmCgB,KAAK;AACvE,OAAO,MAAMG,wBAAwB,GAAGA,CAAA,KAAM;EAC3CD,aAAa,CAA2BE,KAAK,CAAC,CAAC;AAClD,CAAC;AAED,OAAO,MAAMC,wBAAwB,GAAIjB,IAAc,IAAK;EAC1D,MAAME,WAAW,GAAGF,IAAI,CAACG,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,SAAS,CAAC,CAAC,CAAC;EACnD,IAAI,CAACH,WAAW,EAAE;IAChB,MAAM,IAAII,KAAK,CAAE,8BAA6BN,IAAI,CAACO,IAAI,CAACC,IAAK,EAAC,CAAC;EACjE;EAEAX,MAAM,CAACqB,MAAM,CAAChB,WAAW,CAAC;AAC5B,CAAC"}