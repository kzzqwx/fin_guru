"use strict";

var _react = /*#__PURE__*/_interopRequireDefault( /*#__PURE__*/require("react"));
var _plasmaCyUtils = /*#__PURE__*/require("@salutejs/plasma-cy-utils");
var _plasmaCore = /*#__PURE__*/require("@salutejs/plasma-core");
var _plasmaIcons = /*#__PURE__*/require("@salutejs/plasma-icons");
var _IconEdit, _IconEdit2;
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }
var paste = function paste(selector, text) {
  // https://github.com/cypress-io/cypress/issues/2386#issuecomment-613374266
  cy.get(selector).first().then(function ($destination) {
    // https://developer.mozilla.org/en-US/docs/Web/API/Element/paste_event
    var pasteEvent = Object.assign(new Event('paste', {
      bubbles: true,
      cancelable: true
    }), {
      clipboardData: {
        getData: function getData() {
          return text;
        }
      }
    });
    $destination[0].dispatchEvent(pasteEvent);
  });
};
var noop = function noop() {};
describe('plasma-hope: Editable', function () {
  var _CypressTestDecorator, _CypressTestDecorator2, _CypressTestDecorator3, _CypressTestDecorator4, _CypressTestDecorator5;
  var Editable = (0, _plasmaCyUtils.getComponent)('Editable');
  it('simple', function () {
    (0, _plasmaCyUtils.mount)(_CypressTestDecorator || (_CypressTestDecorator = /*#__PURE__*/_react["default"].createElement(_plasmaCyUtils.CypressTestDecorator, null, /*#__PURE__*/_react["default"].createElement(Editable, {
      value: "\u041F\u0440\u0438\u043C\u0435\u0440 \u0442\u0435\u043A\u0441\u0442\u0430",
      textComponent: _plasmaCore.Headline1
    }))));
    cy.matchImageSnapshot();
  });
  it('empty', function () {
    (0, _plasmaCyUtils.mount)(_CypressTestDecorator2 || (_CypressTestDecorator2 = /*#__PURE__*/_react["default"].createElement(_plasmaCyUtils.CypressTestDecorator, null, /*#__PURE__*/_react["default"].createElement(Editable, {
      textComponent: _plasmaCore.Headline1,
      icon: _IconEdit || (_IconEdit = /*#__PURE__*/_react["default"].createElement(_plasmaIcons.IconEdit, {
        size: "s",
        color: "inherit"
      }))
    }))));
    cy.matchImageSnapshot();
  });
  it('onChange', function () {
    (0, _plasmaCyUtils.mount)(_CypressTestDecorator3 || (_CypressTestDecorator3 = /*#__PURE__*/_react["default"].createElement(_plasmaCyUtils.CypressTestDecorator, null, /*#__PURE__*/_react["default"].createElement(Editable, {
      value: "onChange",
      onChange: noop,
      maxLength: 5,
      textComponent: _plasmaCore.Headline1
    }))));
    cy.get('span > div').first().type('Hello');
    cy.get('span > div').first().type('Hello world');
    cy.matchImageSnapshot();
  });
  it('onBlur and onFocus', function () {
    (0, _plasmaCyUtils.mount)(_CypressTestDecorator4 || (_CypressTestDecorator4 = /*#__PURE__*/_react["default"].createElement(_plasmaCyUtils.CypressTestDecorator, null, /*#__PURE__*/_react["default"].createElement(Editable, {
      value: "onBlur and onFocus",
      onBlur: noop,
      icon: _IconEdit2 || (_IconEdit2 = /*#__PURE__*/_react["default"].createElement(_plasmaIcons.IconEdit, {
        size: "s",
        color: "inherit"
      })),
      textComponent: _plasmaCore.Headline1
    }))));
    cy.get('span > span').click();
    cy.get('span > div').first().blur();

    // для случаев, если не поддерживаются современные интерфейсы window
    cy.window().then(function (win) {
      // NOTE: https://github.com/salute-developers/plasma/issues/384
      // callsFake не работает с данным методом
      // cy.stub(win, 'getSelection', undefined);

      // для браузеров IE < 9 при использовании компонента
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      win.document.selection = {
        empty: noop
      };
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      win.document.body.createTextRange = function () {
        return {
          moveToElementText: noop,
          select: noop
        };
      };
    });
    cy.get('span > div').first().focus();
    cy.get('span > div').first().trigger('keydown', {
      keyCode: 13
    });
    cy.matchImageSnapshot();
  });
  it('onPaste', function () {
    (0, _plasmaCyUtils.mount)(_CypressTestDecorator5 || (_CypressTestDecorator5 = /*#__PURE__*/_react["default"].createElement(_plasmaCyUtils.CypressTestDecorator, null, /*#__PURE__*/_react["default"].createElement(Editable, {
      value: "onPaste",
      onPaste: noop,
      textComponent: _plasmaCore.Headline1
    }))));
    paste('span > div', 'Hello from paste');

    // для случаев, если не поддерживаются современные интерфейсы window
    cy.window().then(function (win) {
      cy.stub(win.document, 'queryCommandSupported').callsFake(function () {
        return false;
      });
      cy.stub(navigator.clipboard, 'writeText').callsFake(undefined);
      paste('span > div', 'Hello from paste');
    });
    cy.matchImageSnapshot();
  });
});