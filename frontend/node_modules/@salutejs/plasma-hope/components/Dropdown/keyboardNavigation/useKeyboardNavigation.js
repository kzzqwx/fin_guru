"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useKeyboardNavigation = exports.INITIAL_INDEX = void 0;
var _react = /*#__PURE__*/require("react");
var _utils = /*#__PURE__*/require("./utils");
var _useOnComboType = /*#__PURE__*/require("./useOnComboType");
var INITIAL_INDEX = exports.INITIAL_INDEX = 0;

/**
 * Клавиатурная навигация для dropdown.
 * Работает для каждого instance dropdown, (popup) отдельно.
 */
var useKeyboardNavigation = exports.useKeyboardNavigation = function useKeyboardNavigation(_ref) {
  var items = _ref.items,
    isOpen = _ref.isOpen,
    _ref$index = _ref.index,
    index = _ref$index === void 0 ? INITIAL_INDEX : _ref$index,
    onToggle = _ref.onToggle,
    onItemSelect = _ref.onItemSelect,
    onIndexChange = _ref.onIndexChange;
  var getIndexByTyping = (0, _useOnComboType.useOnComboType)({
    index: index,
    items: items
  });
  var onKeyDown = (0, _react.useCallback)(function (event) {
    if (!items.length) {
      return;
    }
    var action = (0, _utils.getActionFromKey)(event, isOpen);
    if (action === _utils.Actions.Last || action === _utils.Actions.First || action === _utils.Actions.Next || action === _utils.Actions.Previous || action === _utils.Actions.PageUp || action === _utils.Actions.PageDown) {
      event.preventDefault();
      onIndexChange === null || onIndexChange === void 0 || onIndexChange((0, _utils.getUpdatedIndex)(action, index, items));
    } else if (action === _utils.Actions.Select) {
      event.stopPropagation();
      event.preventDefault();
      onItemSelect === null || onItemSelect === void 0 || onItemSelect(items[index], event);
    } else if (action === _utils.Actions.Open) {
      event.preventDefault();
      onToggle === null || onToggle === void 0 || onToggle(true, event);
    } else if (action === _utils.Actions.Close) {
      event.preventDefault();
      onToggle === null || onToggle === void 0 || onToggle(false, event);
    } else if (action === _utils.Actions.Type) {
      event.preventDefault();
      var newIndex = getIndexByTyping(event.key);
      if (newIndex !== undefined) {
        onIndexChange === null || onIndexChange === void 0 || onIndexChange(newIndex);
      }
    }
  }, [isOpen, index, items, onIndexChange, onToggle, getIndexByTyping]);
  return {
    onKeyDown: onKeyDown,
    index: index
  };
};