var _IconTrashFilled, _IconTrashFilled2, _IconTrashFilled3, _IconTrashFilled4, _PadMe, _IconTrashFilled5, _IconTrashFilled6, _PadMe2, _IconTrashFilled7, _IconTrashFilled8, _PadMe3, _IconTrashFilled9, _IconTrashFilled10;
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
import React from 'react';
import { CypressTestDecorator, getComponent, mount, PadMe } from '@salutejs/plasma-cy-utils';
import { IconTrashFilled } from '@salutejs/plasma-icons';
import { arrayItemRemoving, arrayItemSelecting, arrayItemSwapping } from './utils';
var base64 = 'data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdj';
var itemBase = {
  id: 1,
  image: /*#__PURE__*/"".concat(base64, "+N/Q8B8AB4AC/xY2aM8AAAAASUVORK5CYII=")
};
var itemCustom = {
  id: 1,
  component: /*#__PURE__*/React.createElement("div", {
    style: {
      width: '150px',
      height: '150px',
      background: 'red'
    }
  }, "Test custom component"),
  customClickHandle: function customClickHandle() {}
};
var itemsExamples = [{
  id: 1,
  image: /*#__PURE__*/"".concat(base64, "+N/Q8B8AB4AC/xY2aM8AAAAASUVORK5CYII="),
  caption: '3:24'
}, {
  id: 2,
  image: /*#__PURE__*/"".concat(base64, "+N/g8B8ABwACvwQSYaIAAAAASUVORK5CYII="),
  isSelected: true
}, {
  id: 3,
  image: /*#__PURE__*/"".concat(base64, "aGj4/x8ABoIC/5x793MAAAAASUVORK5CYII=")
}, {
  id: 4,
  image: /*#__PURE__*/"".concat(base64, "YPjf8B8ABQECf1y8ZwgAAAAASUVORK5CYII=")
}, {
  id: 5,
  image: /*#__PURE__*/"".concat(base64, "+P+/4T8ACP0Dftzno5UAAAAASUVORK5CYII=")
}, {
  id: 6,
  image: '',
  status: 'error',
  tooltip: {
    text: 'Ошибка, изображение не загрузилось',
    placement: 'top'
  }
}];
describe('plasma-hope: PreviewGallery', function () {
  var _CypressTestDecorator, _CypressTestDecorator2, _CypressTestDecorator3;
  var PreviewGallery = getComponent('PreviewGallery');
  it('simple selectable', function () {
    mount(_CypressTestDecorator || (_CypressTestDecorator = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: itemsExamples,
      actionIcon: _IconTrashFilled || (_IconTrashFilled = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      })),
      interactionType: "selectable"
    }))));
    cy.matchImageSnapshot();
  });
  it('simple draggable', function () {
    mount(_CypressTestDecorator2 || (_CypressTestDecorator2 = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: itemsExamples,
      actionIcon: _IconTrashFilled2 || (_IconTrashFilled2 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      })),
      interactionType: "draggable"
    }))));
    cy.matchImageSnapshot();
  });
  it('with tooltip', function () {
    mount(_CypressTestDecorator3 || (_CypressTestDecorator3 = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: itemsExamples,
      interactionType: "selectable"
    }))));
    cy.get('div > div > div').last().trigger('mouseover', {
      waitForAnimations: true
    });
    cy.matchImageSnapshot();
  });
  it('custom item', function () {
    mount( /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemCustom],
      actionIcon: _IconTrashFilled3 || (_IconTrashFilled3 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      })),
      interactionType: "selectable"
    })));
    cy.matchImageSnapshot();
  });
  it('_isSelected', function () {
    var itemSelected = {
      id: 1,
      image: "".concat(base64, "+N/Q8B8AB4AC/xY2aM8AAAAASUVORK5CYII="),
      isSelected: true
    };
    mount( /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemSelected],
      actionIcon: _IconTrashFilled4 || (_IconTrashFilled4 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    }), _PadMe || (_PadMe = /*#__PURE__*/React.createElement(PadMe, null)), /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemBase],
      actionIcon: _IconTrashFilled5 || (_IconTrashFilled5 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    })));
    cy.matchImageSnapshot();
  });
  it('_caption', function () {
    var itemCaption = {
      id: 1,
      image: "".concat(base64, "+N/Q8B8AB4AC/xY2aM8AAAAASUVORK5CYII="),
      caption: '42:42'
    };
    mount( /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemCaption],
      actionIcon: _IconTrashFilled6 || (_IconTrashFilled6 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    }), _PadMe2 || (_PadMe2 = /*#__PURE__*/React.createElement(PadMe, null)), /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemBase],
      actionIcon: _IconTrashFilled7 || (_IconTrashFilled7 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    })));
    cy.matchImageSnapshot();
  });
  it('_status', function () {
    var itemError = {
      id: 1,
      status: 'error',
      image: "".concat(base64, "+N/Q8B8AB4AC/xY2aM8AAAAASUVORK5CYII=")
    };
    mount( /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemError],
      actionIcon: _IconTrashFilled8 || (_IconTrashFilled8 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    }), _PadMe3 || (_PadMe3 = /*#__PURE__*/React.createElement(PadMe, null)), /*#__PURE__*/React.createElement(PreviewGallery, {
      items: [itemBase],
      actionIcon: _IconTrashFilled9 || (_IconTrashFilled9 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    })));
    cy.matchImageSnapshot();
  });
});
describe('plasma-hope: PreviewGallery utils', function () {
  var _Demo, _CypressTestDecorator4, _CypressTestDecorator5, _CypressTestDecorator6;
  var PreviewGallery = getComponent('PreviewGallery');
  function Demo(_ref) {
    var interactionType = _ref.interactionType,
      itemsExternal = _ref.itemsExternal;
    var _React$useState = React.useState(itemsExternal),
      _React$useState2 = _slicedToArray(_React$useState, 2),
      items = _React$useState2[0],
      setItems = _React$useState2[1];
    var onItemRemove = React.useCallback(function (id) {
      setItems(function (oldItems) {
        var newItems = arrayItemRemoving(oldItems, id);
        if (newItems.length === 1) {
          newItems[0].isSelected = true;
        }
        return newItems;
      });
    }, []);
    var onItemSelect = React.useCallback(function (id) {
      setItems(function (oldItems) {
        return arrayItemSelecting(oldItems, id);
      });
    }, []);
    var onItemsSortEnd = React.useCallback(function (_ref2) {
      var oldIndex = _ref2.oldIndex,
        newIndex = _ref2.newIndex;
      setItems(function (oldItems) {
        return arrayItemSwapping(oldItems, oldIndex, newIndex);
      });
    }, []);
    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(PreviewGallery, {
      items: items,
      interactionType: interactionType,
      onItemAction: onItemRemove,
      onItemsSortEnd: onItemsSortEnd,
      onItemClick: onItemSelect,
      actionIcon: _IconTrashFilled10 || (_IconTrashFilled10 = /*#__PURE__*/React.createElement(IconTrashFilled, {
        size: "xs",
        color: "inherit"
      }))
    }), /*#__PURE__*/React.createElement("div", {
      style: {
        marginTop: '150px',
        visibility: 'hidden'
      }
    }, "helper"));
  }
  it('empty items list and incorrect id', function () {
    mount( /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(React.Fragment, null, _Demo || (_Demo = /*#__PURE__*/React.createElement(Demo, {
      interactionType: "selectable"
    })), /*#__PURE__*/React.createElement(Demo, {
      itemsExternal: [],
      interactionType: "selectable"
    }), /*#__PURE__*/React.createElement(Demo, {
      itemsExternal: [],
      interactionType: "draggable"
    }))));
    expect(arrayItemSelecting([], 1)).to.deep.eq([]);
    expect(arrayItemRemoving([], 0)).to.deep.eq([]);
    expect(arrayItemSwapping([], 0, 0)).to.deep.eq([]);
    expect(arrayItemRemoving(itemsExamples, 123)).to.deep.eq(itemsExamples);
    expect(arrayItemSelecting(itemsExamples, 123)).to.deep.eq(itemsExamples);
    cy.matchImageSnapshot();
  });
  it('remove last item', function () {
    mount(_CypressTestDecorator4 || (_CypressTestDecorator4 = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(Demo, {
      itemsExternal: itemsExamples,
      interactionType: "selectable"
    }))));
    cy.get('div + div ~ div').last().find('button').click({
      force: true
    });
    cy.matchImageSnapshot();
  });
  it('select first item', function () {
    mount(_CypressTestDecorator5 || (_CypressTestDecorator5 = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(Demo, {
      itemsExternal: itemsExamples,
      interactionType: "selectable"
    }))));
    cy.get('div > div > div').first().click();
    cy.matchImageSnapshot();
  });
  it('drag first item to last', function () {
    mount(_CypressTestDecorator6 || (_CypressTestDecorator6 = /*#__PURE__*/React.createElement(CypressTestDecorator, null, /*#__PURE__*/React.createElement(Demo, {
      itemsExternal: itemsExamples,
      interactionType: "draggable"
    }))));
    cy.get('div > div > div').first().trigger('mousedown', {
      waitForAnimations: true
    });
    cy.get('div > div > div').last().trigger('mousemove', {
      pageX: 0,
      pageY: 100
    });
    cy.root().click();
    cy.matchImageSnapshot();
  });
});