{"version":3,"file":"useDrawer.js","sources":["../../../../src/components/Drawer/hooks/useDrawer.ts"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\n\nimport { DrawerInfo, getIdLastDrawer, hasDrawers } from '../DrawerContext';\nimport { DrawerHookArgs } from '../Drawer.types';\nimport { usePopupContext } from '../../Popup';\n\nconst ESCAPE_KEYCODE = 27;\n\nexport const useDrawer = ({\n    id,\n    isOpen,\n    popupInfo,\n    onEscKeyDown,\n    onClose,\n    closeOnEsc = true,\n    disableScroll = true,\n}: DrawerHookArgs) => {\n    const popupController = usePopupContext();\n    const overflow = useRef<string>(document.body.style.overflowY);\n\n    // При ESC закрывает текущее окно, если это возможно\n    const onKeyDown = useCallback(\n        (event: KeyboardEvent) => {\n            if (!closeOnEsc) {\n                return;\n            }\n            if (event.keyCode === ESCAPE_KEYCODE && getIdLastDrawer(popupController.items) === id) {\n                if (onEscKeyDown) {\n                    onEscKeyDown(event);\n                    return;\n                }\n\n                if (onClose) {\n                    onClose();\n                }\n            }\n        },\n        [onClose, onEscKeyDown, popupController.items, closeOnEsc],\n    );\n\n    useEffect(() => {\n        window.addEventListener('keydown', onKeyDown);\n        return () => {\n            window.removeEventListener('keydown', onKeyDown);\n        };\n    }, [onKeyDown]);\n\n    // linaria не поддерживает динамический global\n    useEffect(() => {\n        if (isOpen && disableScroll) {\n            overflow.current = document.body.style.overflowY;\n            document.body.style.overflowY = 'hidden';\n        }\n    }, [isOpen, disableScroll]);\n\n    useEffect(() => {\n        if (!isOpen && !hasDrawers(popupController.items)) {\n            document.body.style.overflowY = overflow.current;\n        }\n    }, [isOpen, popupController.items]);\n\n    const drawerInfo: DrawerInfo = {\n        id,\n        info: {\n            isDrawer: true,\n        },\n        ...popupInfo,\n    };\n\n    return { drawerInfo };\n};\n"],"names":["ESCAPE_KEYCODE","useDrawer","_ref","id","isOpen","popupInfo","onEscKeyDown","onClose","_ref$closeOnEsc","closeOnEsc","_ref$disableScroll","disableScroll","popupController","usePopupContext","overflow","useRef","document","body","style","overflowY","onKeyDown","useCallback","event","keyCode","getIdLastDrawer","items","useEffect","window","addEventListener","removeEventListener","current","hasDrawers","drawerInfo","_objectSpread","info","isDrawer"],"mappings":";;;;;;;;;;;;;AAMA,IAAMA,cAAc,GAAG,EAAE,CAAA;IAEZC,SAAS,GAAG,SAAZA,SAASA,CAAAC,IAAA,EAQA;AAAA,EAAA,IAPlBC,EAAE,GAAAD,IAAA,CAAFC,EAAE;IACFC,MAAM,GAAAF,IAAA,CAANE,MAAM;IACNC,SAAS,GAAAH,IAAA,CAATG,SAAS;IACTC,YAAY,GAAAJ,IAAA,CAAZI,YAAY;IACZC,OAAO,GAAAL,IAAA,CAAPK,OAAO;IAAAC,eAAA,GAAAN,IAAA,CACPO,UAAU;AAAVA,IAAAA,UAAU,GAAAD,eAAA,KAAG,KAAA,CAAA,GAAA,IAAI,GAAAA,eAAA;IAAAE,kBAAA,GAAAR,IAAA,CACjBS,aAAa;AAAbA,IAAAA,aAAa,GAAAD,kBAAA,KAAG,KAAA,CAAA,GAAA,IAAI,GAAAA,kBAAA,CAAA;AAEpB,EAAA,IAAME,eAAe,GAAGC,4BAAe,EAAE,CAAA;EACzC,IAAMC,QAAQ,GAAGC,YAAM,CAASC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,CAAC,CAAA;;AAE9D;AACA,EAAA,IAAMC,SAAS,GAAGC,iBAAW,CACzB,UAACC,KAAoB,EAAK;IACtB,IAAI,CAACb,UAAU,EAAE;AACb,MAAA,OAAA;AACJ,KAAA;AACA,IAAA,IAAIa,KAAK,CAACC,OAAO,KAAKvB,cAAc,IAAIwB,6BAAe,CAACZ,eAAe,CAACa,KAAK,CAAC,KAAKtB,EAAE,EAAE;AACnF,MAAA,IAAIG,YAAY,EAAE;QACdA,YAAY,CAACgB,KAAK,CAAC,CAAA;AACnB,QAAA,OAAA;AACJ,OAAA;AAEA,MAAA,IAAIf,OAAO,EAAE;AACTA,QAAAA,OAAO,EAAE,CAAA;AACb,OAAA;AACJ,KAAA;AACJ,GAAC,EACD,CAACA,OAAO,EAAED,YAAY,EAAEM,eAAe,CAACa,KAAK,EAAEhB,UAAU,CAC7D,CAAC,CAAA;AAEDiB,EAAAA,eAAS,CAAC,YAAM;AACZC,IAAAA,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAER,SAAS,CAAC,CAAA;AAC7C,IAAA,OAAO,YAAM;AACTO,MAAAA,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAET,SAAS,CAAC,CAAA;KACnD,CAAA;AACL,GAAC,EAAE,CAACA,SAAS,CAAC,CAAC,CAAA;;AAEf;AACAM,EAAAA,eAAS,CAAC,YAAM;IACZ,IAAItB,MAAM,IAAIO,aAAa,EAAE;MACzBG,QAAQ,CAACgB,OAAO,GAAGd,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,CAAA;AAChDH,MAAAA,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,GAAG,QAAQ,CAAA;AAC5C,KAAA;AACJ,GAAC,EAAE,CAACf,MAAM,EAAEO,aAAa,CAAC,CAAC,CAAA;AAE3Be,EAAAA,eAAS,CAAC,YAAM;IACZ,IAAI,CAACtB,MAAM,IAAI,CAAC2B,wBAAU,CAACnB,eAAe,CAACa,KAAK,CAAC,EAAE;MAC/CT,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,GAAGL,QAAQ,CAACgB,OAAO,CAAA;AACpD,KAAA;GACH,EAAE,CAAC1B,MAAM,EAAEQ,eAAe,CAACa,KAAK,CAAC,CAAC,CAAA;EAEnC,IAAMO,UAAsB,GAAAC,uCAAA,CAAA;AACxB9B,IAAAA,EAAE,EAAFA,EAAE;AACF+B,IAAAA,IAAI,EAAE;AACFC,MAAAA,QAAQ,EAAE,IAAA;AACd,KAAA;AAAC,GAAA,EACE9B,SAAS,CACf,CAAA;EAED,OAAO;AAAE2B,IAAAA,UAAU,EAAVA,UAAAA;GAAY,CAAA;AACzB;;;;"}