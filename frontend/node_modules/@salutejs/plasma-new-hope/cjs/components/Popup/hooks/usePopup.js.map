{"version":3,"file":"usePopup.js","sources":["../../../../src/components/Popup/hooks/usePopup.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport type { PopupAnimationInfo, PopupHookArgs } from '../Popup.types';\nimport { usePopupContext } from '../PopupContext';\n\n// Хук для поключения анимации\nconst usePopupAnimation = (): PopupAnimationInfo => {\n    const [endAnimation, setEndAnimation] = useState<boolean>(false);\n    const [endTransition, setEndTransition] = useState<boolean>(false);\n\n    return { endAnimation, endTransition, setEndTransition, setEndAnimation };\n};\n\n// Хук для внутреннего состояния, необходимого для правильного отображения вложенных окон, а также для анимации\nexport const usePopup = ({ isOpen, id, popupInfo, withAnimation }: PopupHookArgs) => {\n    const [isVisible, setVisible] = useState<boolean>(false);\n    const popupController = usePopupContext();\n    const animationInfo = usePopupAnimation();\n\n    // для использования transition в качестве анимации\n    useEffect(() => {\n        if (withAnimation && animationInfo) {\n            animationInfo.setEndTransition(!isVisible || animationInfo?.endAnimation);\n        }\n    }, [animationInfo, withAnimation, isVisible]);\n\n    // сначала добавление/удаление из контекста, и только после этого отображение/скрытие\n    useEffect(() => {\n        // при первом открытии\n        if (isOpen && !isVisible) {\n            popupController.register({ id, ...popupInfo });\n            setVisible(true);\n            animationInfo.setEndAnimation(false);\n            return;\n        }\n\n        if (isOpen || !isVisible) {\n            return;\n        }\n\n        // если есть анимация - закрытие по окончании анимации\n        if (withAnimation) {\n            animationInfo.setEndAnimation(true);\n            return;\n        }\n\n        // иначе обычное закрытие\n        popupController.unregister(id);\n        setVisible(false);\n    }, [isOpen, isVisible, animationInfo]);\n\n    return { isVisible, setVisible, animationInfo, withAnimation };\n};\n"],"names":["usePopupAnimation","_useState","useState","_useState2","_slicedToArray","endAnimation","setEndAnimation","_useState3","_useState4","endTransition","setEndTransition","usePopup","_ref","isOpen","id","popupInfo","withAnimation","_useState5","_useState6","isVisible","setVisible","popupController","usePopupContext","animationInfo","useEffect","register","_objectSpread","unregister"],"mappings":"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"}