{"version":3,"file":"common.js","sources":["../../src/engines/common.tsx"],"sourcesContent":["import React from 'react';\n\nimport { _component } from './linaria';\nimport type {\n    ComponentConfig,\n    HTMLAnyAttributes,\n    HTMLTagList,\n    PropsType,\n    Variants,\n    HTMLAttributesOmitOnChange,\n} from './types';\n\n//\n// Тип HTMLAttributesOmitOnChange требуется чтобы использовать компонент с кастомным пропсом onChange\n//\n\nexport const getStaticVariants = (config: ComponentConfig) => {\n    if (!config.variations) {\n        return [];\n    }\n    const res = [];\n    const { variations } = config;\n\n    // eslint-disable-next-line guard-for-in\n    for (const key in variations) {\n        const { css } = variations[key];\n        css && res.push(css);\n    }\n\n    return res;\n};\n\nexport const getDynamicVariants = (config: ComponentConfig) => {\n    return (props: HTMLAnyAttributes) => {\n        const res = [];\n\n        // eslint-disable-next-line guard-for-in\n        for (const key in config.variations) {\n            if (key in props) {\n                const variant = config.variations[key];\n\n                const css = variant[props[key]];\n                // no css for { modifier: true }\n                css && Array.isArray(css) ? res.push(...css) : res.push(css);\n            }\n        }\n\n        return res;\n    };\n};\n\nexport const mergeConfig = <\n    Tag extends HTMLTagList,\n    VariantList extends Variants,\n    VariantsProps extends PropsType<VariantList>,\n    LayoutPropsBase extends React.HTMLAttributes<HTMLElement> | HTMLAttributesOmitOnChange,\n    LayoutPropsUser extends React.HTMLAttributes<HTMLElement> | HTMLAttributesOmitOnChange | undefined = undefined\n>(\n    baseConfig: ComponentConfig<Tag, Variants, PropsType & LayoutPropsBase, LayoutPropsBase>,\n    userConfig?: Partial<ComponentConfig<Tag, VariantList, VariantsProps, LayoutPropsUser>>,\n) => {\n    const res = { ...baseConfig, ...userConfig };\n\n    if (res.variations) {\n        // copy variations base css\n        // eslint-disable-next-line guard-for-in\n        for (const key in res.variations) {\n            const variant = baseConfig.variations[key];\n\n            res.variations[key].css = variant?.css;\n            /* start of bad decision */\n            if (!res.variations[key].true && variant?.true) {\n                res.variations[key].true = variant.true;\n            }\n            /* end of bad decision */\n            if (variant?.attrs) {\n                res.variations[key].attrs = variant.attrs;\n            }\n        }\n    }\n\n    // eslint-disable-next-line guard-for-in\n    for (const key in baseConfig.defaults || {}) {\n        if (!(key in res.defaults)) {\n            res.defaults[key] = baseConfig.defaults[key];\n        }\n    }\n\n    return res as ComponentConfig<\n        Tag,\n        VariantList,\n        PropsType<VariantList>,\n        LayoutPropsUser extends undefined ? LayoutPropsBase : LayoutPropsUser\n    >;\n};\n\nexport function component<\n    Tag extends HTMLTagList,\n    VariantList extends Variants,\n    VariantsProps extends PropsType<VariantList>,\n    LayoutProps extends React.HTMLAttributes<HTMLElement> | HTMLAttributesOmitOnChange\n>(\n    config: ComponentConfig<Tag, VariantList, VariantsProps, LayoutProps>,\n): React.FunctionComponent<VariantsProps & LayoutProps> {\n    const Comp = config.layout(_component((config as unknown) as ComponentConfig));\n\n    return React.forwardRef<VariantsProps & LayoutProps, any>((props, ref) => (\n        <Comp {...config?.defaults} {...props} ref={ref} />\n    ));\n}\n"],"names":["getStaticVariants","config","variations","res","key","css","push","getDynamicVariants","props","variant","Array","isArray","apply","_toConsumableArray","mergeConfig","baseConfig","userConfig","_objectSpread","attrs","defaults","component","Comp","layout","_component","React","forwardRef","ref","createElement","_extends"],"mappings":"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"}