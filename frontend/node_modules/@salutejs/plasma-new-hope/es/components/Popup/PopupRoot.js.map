{"version":3,"file":"PopupRoot.js","sources":["../../../src/components/Popup/PopupRoot.tsx"],"sourcesContent":["import React, { useCallback, forwardRef, useRef, AnimationEvent, TransitionEvent } from 'react';\nimport { useForkRef } from '@salutejs/plasma-core';\n\nimport { usePopupContext } from './PopupContext';\nimport type { PopupRootProps } from './Popup.types';\nimport { PopupRootContainer, PopupView } from './Popup.styles';\nimport { classes } from './Popup.tokens';\n\n/**\n * Корень Popup.\n * Управляет показом/скрытием и анимацией всплывающего окна.\n */\nexport const PopupRoot = forwardRef<HTMLDivElement, PopupRootProps>(\n    ({ id, placement, offset, frame, setVisible, children, role, zIndex, animationInfo, className, ...rest }, ref) => {\n        const contentRef = useRef<HTMLDivElement | null>(null);\n        const innerRef = useForkRef<HTMLDivElement>(contentRef, ref);\n\n        const popupController = usePopupContext();\n\n        const handleAnimationEnd = useCallback(\n            (e: AnimationEvent<HTMLDivElement> | TransitionEvent<HTMLDivElement>) => {\n                if (!contentRef || e.target !== contentRef.current) {\n                    return;\n                }\n                e.stopPropagation();\n                if (animationInfo?.endAnimation) {\n                    popupController.unregister(id);\n                    setVisible(false);\n                    animationInfo.setEndAnimation(false);\n                }\n            },\n            [popupController.unregister, animationInfo?.endAnimation, setVisible],\n        );\n\n        return (\n            <PopupRootContainer\n                className={classes.root}\n                ref={innerRef}\n                placement={placement}\n                frame={frame}\n                offset={offset}\n                zIndex={zIndex}\n                onAnimationEnd={handleAnimationEnd}\n                onTransitionEnd={handleAnimationEnd}\n                {...rest}\n            >\n                <PopupView role={role}>{children}</PopupView>\n            </PopupRootContainer>\n        );\n    },\n);\n"],"names":["PopupRoot","forwardRef","_ref","ref","id","placement","offset","frame","setVisible","children","role","zIndex","animationInfo","rest","_objectWithoutProperties","_excluded","contentRef","useRef","innerRef","useForkRef","popupController","usePopupContext","handleAnimationEnd","useCallback","e","target","current","stopPropagation","endAnimation","unregister","setEndAnimation","React","createElement","PopupRootContainer","_extends","className","classes","root","onAnimationEnd","onTransitionEnd","PopupView"],"mappings":";;;;;;;;;AAQA;AACA;AACA;AACA;AACO,IAAMA,SAAS,gBAAGC,UAAU,CAC/B,UAAAC,IAAA,EAA0GC,GAAG,EAAK;AAAA,EAAA,IAA/GC,EAAE,GAAAF,IAAA,CAAFE,EAAE,CAAA;IAAEC,SAAS,GAAAH,IAAA,CAATG,SAAS,CAAA;IAAEC,MAAM,GAAAJ,IAAA,CAANI,MAAM,CAAA;IAAEC,KAAK,GAAAL,IAAA,CAALK,KAAK,CAAA;IAAEC,UAAU,GAAAN,IAAA,CAAVM,UAAU,CAAA;IAAEC,QAAQ,GAAAP,IAAA,CAARO,QAAQ,CAAA;IAAEC,IAAI,GAAAR,IAAA,CAAJQ,IAAI,CAAA;IAAEC,MAAM,GAAAT,IAAA,CAANS,MAAM,CAAA;IAAEC,aAAa,GAAAV,IAAA,CAAbU,aAAa,CAAA;IAAgBC,IAAI,GAAAC,wBAAA,CAAAZ,IAAA,EAAAa,SAAA,EAAA;AAClG,EAAA,IAAMC,UAAU,GAAGC,MAAM,CAAwB,IAAI,CAAC,CAAA;AACtD,EAAA,IAAMC,QAAQ,GAAGC,UAAU,CAAiBH,UAAU,EAAEb,GAAG,CAAC,CAAA;AAE5D,EAAA,IAAMiB,eAAe,GAAGC,eAAe,EAAE,CAAA;AAEzC,EAAA,IAAMC,kBAAkB,GAAGC,WAAW,CAClC,UAACC,CAAmE,EAAK;IACrE,IAAI,CAACR,UAAU,IAAIQ,CAAC,CAACC,MAAM,KAAKT,UAAU,CAACU,OAAO,EAAE;AAChD,MAAA,OAAA;AACJ,KAAA;IACAF,CAAC,CAACG,eAAe,EAAE,CAAA;AACnB,IAAA,IAAIf,aAAa,KAAbA,IAAAA,IAAAA,aAAa,eAAbA,aAAa,CAAEgB,YAAY,EAAE;AAC7BR,MAAAA,eAAe,CAACS,UAAU,CAACzB,EAAE,CAAC,CAAA;MAC9BI,UAAU,CAAC,KAAK,CAAC,CAAA;AACjBI,MAAAA,aAAa,CAACkB,eAAe,CAAC,KAAK,CAAC,CAAA;AACxC,KAAA;AACJ,GAAC,EACD,CAACV,eAAe,CAACS,UAAU,EAAEjB,aAAa,KAAA,IAAA,IAAbA,aAAa,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAbA,aAAa,CAAEgB,YAAY,EAAEpB,UAAU,CACxE,CAAC,CAAA;AAED,EAAA,oBACIuB,KAAA,CAAAC,aAAA,CAACC,kBAAkB,EAAAC,QAAA,CAAA;IACfC,SAAS,EAAEC,OAAO,CAACC,IAAK;AACxBlC,IAAAA,GAAG,EAAEe,QAAS;AACdb,IAAAA,SAAS,EAAEA,SAAU;AACrBE,IAAAA,KAAK,EAAEA,KAAM;AACbD,IAAAA,MAAM,EAAEA,MAAO;AACfK,IAAAA,MAAM,EAAEA,MAAO;AACf2B,IAAAA,cAAc,EAAEhB,kBAAmB;AACnCiB,IAAAA,eAAe,EAAEjB,kBAAAA;AAAmB,GAAA,EAChCT,IAAI,CAERkB,eAAAA,KAAA,CAAAC,aAAA,CAACQ,SAAS,EAAA;AAAC9B,IAAAA,IAAI,EAAEA,IAAAA;GAAOD,EAAAA,QAAoB,CAC5B,CAAC,CAAA;AAE7B,CACJ;;;;"}