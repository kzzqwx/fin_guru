{"version":3,"file":"Popup.js","sources":["../../../src/components/Popup/Popup.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useRef, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useForkRef, safeUseId } from '@salutejs/plasma-core';\n\nimport { RootProps } from '../../engines/types';\nimport { cx } from '../../utils';\n\nimport type { PopupPlacementBasic, PopupPlacement, PopupPositionType, PopupProps } from './Popup.types';\nimport { POPUP_PORTAL_ID } from './PopupContext';\nimport { PopupRoot } from './PopupRoot';\nimport { usePopup } from './hooks';\nimport { classes } from './Popup.tokens';\n\nexport const handlePosition = (\n    placement: PopupPlacement,\n    offset: [number, number] | [string, string],\n): PopupPositionType => {\n    let x = '0rem';\n    let y = '0rem';\n\n    if (offset) {\n        const [_x, _y] = offset;\n        x = typeof _x === 'number' ? `${_x}rem` : _x;\n        y = typeof _y === 'number' ? `${_y}rem` : _y;\n    }\n\n    if (!placement || placement === 'center') {\n        return {\n            left: `calc(50% + ${x})`,\n            top: `calc(50% - ${y})`,\n            transform: 'translate(-50%, -50%)',\n        };\n    }\n\n    let left;\n    let right;\n    let top;\n    let bottom;\n    let transform;\n    const placements = placement.split('-') as PopupPlacementBasic[];\n\n    placements.forEach((placement: PopupPlacementBasic) => {\n        switch (placement) {\n            case 'left':\n                left = x;\n                break;\n            case 'right':\n                right = x;\n                break;\n            case 'top':\n                top = y;\n                break;\n            case 'bottom':\n                bottom = y;\n                break;\n            default:\n                break;\n        }\n    });\n\n    const isCenteredX = left === undefined && right === undefined;\n    const isCenteredY = top === undefined && bottom === undefined;\n\n    if (isCenteredX) {\n        transform = 'translateX(-50%)';\n    }\n\n    if (isCenteredY) {\n        transform = 'translateY(-50%)';\n    }\n\n    return {\n        left: isCenteredX ? `calc(50% + ${x})` : left,\n        right,\n        top: isCenteredY ? `calc(50% - ${y})` : top,\n        bottom,\n        transform,\n    };\n};\n\n/**\n * Базовый копмонент Popup.\n */\nexport const popupRoot = (Root: RootProps<HTMLDivElement, PopupProps>) =>\n    forwardRef<HTMLDivElement, PopupProps>(\n        (\n            {\n                id,\n                isOpen = false,\n                placement = 'center',\n                offset = [0, 0],\n                frame = 'document',\n                children,\n                overlay,\n                role,\n                zIndex,\n                popupInfo,\n                withAnimation = false,\n                className,\n                ...rest\n            },\n            outerRootRef,\n        ) => {\n            const uniqId = safeUseId();\n            const innerId = id || uniqId;\n\n            const { isVisible, animationInfo, setVisible } = usePopup({\n                isOpen,\n                id: innerId,\n                popupInfo,\n                withAnimation,\n            });\n\n            const portalRef = useRef<HTMLElement | null>(null);\n            const contentRef = useRef<HTMLDivElement | null>(null);\n\n            const innerRef = useForkRef<HTMLDivElement>(contentRef, outerRootRef);\n\n            const [, forceRender] = useState(false);\n\n            useEffect(() => {\n                let portal = document.getElementById(POPUP_PORTAL_ID);\n\n                if (typeof frame !== 'string' && frame && frame.current) {\n                    portal = frame.current;\n                }\n\n                if (!portal) {\n                    portal = document.createElement('div');\n                    portal.setAttribute('id', POPUP_PORTAL_ID);\n                    /**\n                     * Нужно для того, чтобы во фрейме не происходило скачков контента\n                     * при анимации через transform, если есть элемент с шириной/высотой в 100% (Overlay)\n                     */\n                    portal.style.width = '0';\n\n                    if (typeof frame === 'string' && frame !== 'document') {\n                        document.getElementById(frame)?.appendChild(portal);\n                    } else {\n                        document.body.appendChild(portal);\n                    }\n                }\n\n                portalRef.current = portal;\n\n                /**\n                 * Изменение стейта нужно для того, чтобы Popup\n                 * отобразился после записи DOM элемента в portalRef.current\n                 */\n                forceRender(true);\n            }, []);\n\n            if (!isVisible && !isOpen) {\n                return null;\n            }\n\n            const cls = cx(\n                className,\n                animationInfo?.endAnimation ? classes.endAnimation : '',\n                animationInfo?.endTransition ? classes.endTransition : '',\n            );\n\n            return (\n                <>\n                    {portalRef.current &&\n                        ReactDOM.createPortal(\n                            <Root className={cls} {...rest}>\n                                {overlay}\n                                <PopupRoot\n                                    id={innerId}\n                                    ref={innerRef}\n                                    position={handlePosition(placement, offset)}\n                                    frame={frame}\n                                    zIndex={zIndex}\n                                    animationInfo={animationInfo}\n                                    setVisible={setVisible}\n                                >\n                                    {children}\n                                </PopupRoot>\n                            </Root>,\n                            portalRef.current,\n                        )}\n                </>\n            );\n        },\n    );\n\nexport const popupConfig = {\n    name: 'Popup',\n    tag: 'div',\n    layout: popupRoot,\n    base: '',\n    variations: {},\n    defaults: {},\n};\n"],"names":["handlePosition","placement","offset","x","y","_offset","_slicedToArray","_x","_y","concat","left","top","transform","right","bottom","placements","split","forEach","isCenteredX","undefined","isCenteredY","popupRoot","Root","forwardRef","_ref","outerRootRef","id","_ref$isOpen","isOpen","_ref$placement","_ref$offset","_ref$frame","frame","children","overlay","zIndex","popupInfo","_ref$withAnimation","withAnimation","className","rest","_objectWithoutProperties","_excluded","uniqId","safeUseId","innerId","_usePopup","usePopup","isVisible","animationInfo","setVisible","portalRef","useRef","contentRef","innerRef","useForkRef","_useState","useState","_useState2","forceRender","useEffect","portal","document","getElementById","POPUP_PORTAL_ID","current","createElement","setAttribute","style","width","_document$getElementB","appendChild","body","cls","cx","endAnimation","classes","endTransition","React","Fragment","ReactDOM","createPortal","_extends","PopupRoot","ref","position","popupConfig","name","tag","layout","base","variations","defaults"],"mappings":"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"}