{"version":3,"file":"Popover.js","sources":["../../../src/components/Popover/Popover.tsx"],"sourcesContent":["import React, { useRef, useCallback, useEffect, useState, forwardRef } from 'react';\nimport type { CSSProperties } from 'react';\nimport ReactDOM from 'react-dom';\nimport { usePopper } from 'react-popper';\nimport { useFocusTrap, useForkRef } from '@salutejs/plasma-core';\n\nimport type { RootProps } from '../../engines/types';\nimport { cx } from '../../utils';\n\nimport { base as viewCSS } from './variations/_view/base';\nimport type { PopoverPlacement, PopoverProps } from './Popover.types';\nimport { StyledArrow, StyledPopover, StyledRoot, StyledWrapper } from './Popover.styles';\nimport { classes } from './Popover.tokens';\n\nexport const ESCAPE_KEYCODE = 27;\nexport const POPOVER_PORTAL_ID = 'plasma-popover-root';\n\n/**\n * Всплывающее окно с возможностью позиционирования\n * и вызова по клику либо ховеру.\n */\nexport const popoverRoot = (Root: RootProps<HTMLDivElement, PopoverProps>) =>\n    forwardRef<HTMLDivElement, PopoverProps>(\n        (\n            {\n                target,\n                children,\n                isOpen,\n                trigger = 'click',\n                hasArrow,\n                frame = 'document',\n                className,\n                placement = 'auto',\n                offset = [0, 0],\n                zIndex,\n                isFocusTrapped = true,\n                closeOnEsc = true,\n                preventOverflow = true,\n                usePortal = false,\n                view,\n                onToggle,\n                closeOnOverlayClick,\n                ...rest\n            },\n            outerRootRef,\n        ) => {\n            const rootRef = useRef<HTMLDivElement | null>(null);\n            const popoverRef = useRef<HTMLDivElement | null>(null);\n            const handleRef = useForkRef<HTMLDivElement>(rootRef, outerRootRef);\n            const portalRef = useRef<HTMLElement | null>(null);\n\n            const trapRef = useFocusTrap(isOpen && isFocusTrapped);\n\n            const popoverForkRef = useForkRef<HTMLDivElement>(popoverRef, trapRef);\n\n            const [arrowElement, setArrowElement] = useState<HTMLSpanElement | null>(null);\n\n            const [, forceRender] = useState(false);\n\n            const isAutoArray = Array.isArray(placement);\n            const isAuto = isAutoArray || (placement as PopoverPlacement).startsWith('auto');\n\n            const initialStyles = {\n                visibility: isOpen ? 'visible' : 'hidden',\n                opacity: isOpen ? 1 : 0,\n            } as CSSProperties;\n\n            const { styles, attributes, forceUpdate } = usePopper(rootRef.current, popoverRef.current, {\n                // TODO: #1121\n                // eslint-disable-next-line no-nested-ternary\n                placement: isAutoArray\n                    ? placement[0]?.endsWith('start')\n                        ? 'auto-start'\n                        : 'auto'\n                    : (placement as PopoverPlacement),\n                modifiers: [\n                    {\n                        name: 'preventOverflow',\n                        options: {\n                            mainAxis: preventOverflow,\n                        },\n                    },\n                    { name: 'offset', options: { offset: [offset[0], offset[1]] } },\n                    {\n                        name: 'flip',\n                        enabled: isAuto,\n                        options: {\n                            allowedAutoPlacements: isAutoArray ? (placement as PopoverPlacement[]) : [],\n                        },\n                    },\n                    {\n                        name: 'arrow',\n                        options: {\n                            element: arrowElement,\n                        },\n                    },\n                ],\n            });\n\n            const onEscape = useCallback(\n                (event: KeyboardEvent) => {\n                    if (isOpen && closeOnEsc && event.keyCode === ESCAPE_KEYCODE) {\n                        onToggle?.(false, event);\n                    }\n                },\n                [closeOnEsc, isOpen, onToggle],\n            );\n\n            const onDocumentClick = useCallback(\n                (event: MouseEvent) => {\n                    if (isOpen && closeOnOverlayClick && onToggle) {\n                        const targetIsRoot = event.target === rootRef.current;\n                        const rootHasTarget = rootRef.current?.contains(event.target as Element);\n\n                        if (!targetIsRoot && !rootHasTarget) {\n                            onToggle(false, event);\n                        }\n                    }\n                },\n                [closeOnOverlayClick, isOpen, onToggle],\n            );\n\n            const onClick = useCallback<React.MouseEventHandler>(\n                (event) => {\n                    if (trigger === 'click') {\n                        const targetIsPopover = event.target === popoverRef.current;\n                        const rootHasTarget = popoverRef.current?.contains(event.target as Element);\n\n                        if (!targetIsPopover && !rootHasTarget) {\n                            onToggle?.(!isOpen, event);\n                        }\n                    }\n                },\n                [trigger, isOpen, onToggle],\n            );\n\n            const onMouseEnter = useCallback<React.MouseEventHandler>(\n                (event) => {\n                    if (trigger === 'hover') {\n                        onToggle?.(true, event);\n                    }\n                },\n                [trigger, onToggle],\n            );\n\n            const onMouseLeave = useCallback<React.MouseEventHandler>(\n                (event) => {\n                    if (trigger === 'hover') {\n                        onToggle?.(false, event);\n                    }\n                },\n                [trigger, onToggle],\n            );\n\n            const onFocus = useCallback<React.FocusEventHandler>(\n                (event) => {\n                    if (trigger === 'hover') {\n                        onToggle?.(true, event);\n                    }\n                },\n                [trigger, onToggle],\n            );\n\n            const onBlur = useCallback<React.FocusEventHandler>(\n                (event) => {\n                    if (trigger === 'hover') {\n                        onToggle?.(false, event);\n                    }\n                },\n                [trigger, onToggle],\n            );\n\n            useEffect(() => {\n                document.addEventListener('click', onDocumentClick);\n                return () => document.removeEventListener('click', onDocumentClick);\n            }, [isOpen, onToggle]);\n\n            useEffect(() => {\n                window.addEventListener('keydown', onEscape);\n                return () => window.removeEventListener('keydown', onEscape);\n            }, [closeOnEsc, isOpen, onToggle]);\n\n            useEffect(() => {\n                let portal = document.getElementById(POPOVER_PORTAL_ID);\n\n                if (typeof frame !== 'string' && frame && frame.current) {\n                    portal = frame.current;\n                }\n\n                if (!usePortal) {\n                    portal = rootRef.current;\n                }\n\n                if (!portal) {\n                    portal = document.createElement('div');\n                    portal.setAttribute('id', POPOVER_PORTAL_ID);\n\n                    if (typeof frame === 'string' && frame !== 'document') {\n                        document.getElementById(frame)?.appendChild(portal);\n                    } else {\n                        document.body.appendChild(portal);\n                    }\n                }\n\n                portalRef.current = portal;\n\n                /**\n                 * Изменение стейта нужно для того, чтобы Popup\n                 * отобразился после записи DOM элемента в portalRef.current\n                 */\n                forceRender(true);\n            }, []);\n\n            useEffect(() => {\n                if (!isOpen || !forceUpdate) {\n                    return;\n                }\n\n                /*\n                 * INFO: Метод forceUpdate содержит в себе flushSync и приводит\n                 * к повторному рендеру компонента, который уже находится в процессе рендера.\n                 * Данный хак, нужен для того, чтобы это поведение избежать и перенаправить\n                 * вызов метода в очередь микрозадач.\n                 */\n                Promise.resolve().then(forceUpdate);\n            }, [isOpen, children, forceUpdate]);\n\n            return (\n                <StyledWrapper className={classes.wrapper} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave}>\n                    <StyledRoot\n                        ref={handleRef}\n                        onClick={onClick}\n                        onFocus={onFocus}\n                        onBlur={onBlur}\n                        className={cx(className, classes.target)}\n                    >\n                        {target}\n                    </StyledRoot>\n                    {children &&\n                        portalRef.current &&\n                        ReactDOM.createPortal(\n                            <Root view={view} className={className} {...rest}>\n                                <StyledPopover\n                                    {...attributes.popper}\n                                    className={classes.root}\n                                    ref={popoverForkRef}\n                                    style={{\n                                        ...styles.popper,\n                                        ...{ display: isOpen ? 'block' : 'none' },\n                                        ...initialStyles,\n                                    }}\n                                    zIndex={zIndex}\n                                >\n                                    {hasArrow && (\n                                        <StyledArrow\n                                            className={classes.arrow}\n                                            ref={setArrowElement}\n                                            style={styles.arrow}\n                                            {...attributes.arrow}\n                                        />\n                                    )}\n                                    {children}\n                                </StyledPopover>\n                            </Root>,\n                            portalRef.current,\n                        )}\n                </StyledWrapper>\n            );\n        },\n    );\n\nexport const popoverConfig = {\n    name: 'Popover',\n    tag: 'div',\n    layout: popoverRoot,\n    base: '',\n    variations: {\n        view: {\n            css: viewCSS,\n        },\n    },\n    defaults: {\n        view: 'default',\n    },\n};\n"],"names":["ESCAPE_KEYCODE","POPOVER_PORTAL_ID","popoverRoot","Root","forwardRef","_ref","outerRootRef","_placement$","target","children","isOpen","_ref$trigger","trigger","hasArrow","_ref$frame","frame","className","_ref$placement","placement","_ref$offset","offset","zIndex","_ref$isFocusTrapped","isFocusTrapped","_ref$closeOnEsc","closeOnEsc","_ref$preventOverflow","preventOverflow","_ref$usePortal","usePortal","view","onToggle","closeOnOverlayClick","rest","_objectWithoutProperties","_excluded","rootRef","useRef","popoverRef","handleRef","useForkRef","portalRef","trapRef","useFocusTrap","popoverForkRef","_useState","useState","_useState2","_slicedToArray","arrowElement","setArrowElement","_useState3","_useState4","forceRender","isAutoArray","Array","isArray","isAuto","startsWith","initialStyles","visibility","opacity","_usePopper","usePopper","current","endsWith","modifiers","name","options","mainAxis","enabled","allowedAutoPlacements","element","styles","attributes","forceUpdate","onEscape","useCallback","event","keyCode","onDocumentClick","_rootRef$current","targetIsRoot","rootHasTarget","contains","onClick","_popoverRef$current","targetIsPopover","onMouseEnter","onMouseLeave","onFocus","onBlur","useEffect","document","addEventListener","removeEventListener","window","portal","getElementById","createElement","setAttribute","_document$getElementB","appendChild","body","Promise","resolve","then","React","StyledWrapper","classes","wrapper","StyledRoot","ref","cx","ReactDOM","createPortal","_extends","StyledPopover","popper","root","style","_objectSpread","display","StyledArrow","arrow","popoverConfig","tag","layout","base","variations","css","viewCSS","defaults"],"mappings":"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"}