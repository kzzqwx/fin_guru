{"version":3,"file":"useModal.js","sources":["../../../../src/components/Modal/hooks/useModal.ts"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\n\nimport { ModalInfo, getIdLastModal, hasModals } from '../ModalContext';\nimport { ModalHookArgs } from '../Modal.types';\nimport { usePopupContext } from '../../Popup';\n\nconst ESCAPE_KEYCODE = 27;\n\nexport const useModal = ({ id, isOpen, popupInfo, onEscKeyDown, onClose, closeOnEsc = true }: ModalHookArgs) => {\n    const popupController = usePopupContext();\n    const overflow = useRef<string>(document.body.style.overflowY);\n\n    // При ESC закрывает текущее окно, если это возможно\n    const onKeyDown = useCallback(\n        (event: KeyboardEvent) => {\n            if (!closeOnEsc) {\n                return;\n            }\n            if (event.keyCode === ESCAPE_KEYCODE && getIdLastModal(popupController.items) === id) {\n                if (onEscKeyDown) {\n                    onEscKeyDown(event);\n                    return;\n                }\n\n                if (onClose) {\n                    onClose();\n                }\n            }\n        },\n        [onClose, onEscKeyDown, popupController.items, closeOnEsc],\n    );\n\n    useEffect(() => {\n        window.addEventListener('keydown', onKeyDown);\n        return () => {\n            window.removeEventListener('keydown', onKeyDown);\n        };\n    }, [onClose, onEscKeyDown, popupController.items, closeOnEsc]);\n\n    // linaria не поддерживает динамический global\n    useEffect(() => {\n        if (isOpen) {\n            overflow.current = document.body.style.overflowY;\n            document.body.style.overflowY = 'hidden';\n        }\n    }, [isOpen]);\n\n    useEffect(() => {\n        if (!isOpen && !hasModals(popupController.items)) {\n            document.body.style.overflowY = overflow.current;\n        }\n    }, [isOpen, overflow.current, popupController.items]);\n\n    const modalInfo: ModalInfo = {\n        id,\n        info: {\n            isModal: true,\n        },\n        ...popupInfo,\n    };\n\n    return { modalInfo };\n};\n"],"names":["ESCAPE_KEYCODE","useModal","_ref","id","isOpen","popupInfo","onEscKeyDown","onClose","_ref$closeOnEsc","closeOnEsc","popupController","usePopupContext","overflow","useRef","document","body","style","overflowY","onKeyDown","useCallback","event","keyCode","getIdLastModal","items","useEffect","window","addEventListener","removeEventListener","current","hasModals","modalInfo","_objectSpread","info","isModal"],"mappings":";;;;;;;;;AAMA,IAAMA,cAAc,GAAG,EAAE,CAAA;IAEZC,QAAQ,GAAG,SAAXA,QAAQA,CAAAC,IAAA,EAA2F;AAAA,EAAA,IAArFC,EAAE,GAAAD,IAAA,CAAFC,EAAE;IAAEC,MAAM,GAAAF,IAAA,CAANE,MAAM;IAAEC,SAAS,GAAAH,IAAA,CAATG,SAAS;IAAEC,YAAY,GAAAJ,IAAA,CAAZI,YAAY;IAAEC,OAAO,GAAAL,IAAA,CAAPK,OAAO;IAAAC,eAAA,GAAAN,IAAA,CAAEO,UAAU;AAAVA,IAAAA,UAAU,GAAAD,eAAA,KAAG,KAAA,CAAA,GAAA,IAAI,GAAAA,eAAA,CAAA;AACtF,EAAA,IAAME,eAAe,GAAGC,eAAe,EAAE,CAAA;EACzC,IAAMC,QAAQ,GAAGC,MAAM,CAASC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,CAAC,CAAA;;AAE9D;AACA,EAAA,IAAMC,SAAS,GAAGC,WAAW,CACzB,UAACC,KAAoB,EAAK;IACtB,IAAI,CAACX,UAAU,EAAE;AACb,MAAA,OAAA;AACJ,KAAA;AACA,IAAA,IAAIW,KAAK,CAACC,OAAO,KAAKrB,cAAc,IAAIsB,cAAc,CAACZ,eAAe,CAACa,KAAK,CAAC,KAAKpB,EAAE,EAAE;AAClF,MAAA,IAAIG,YAAY,EAAE;QACdA,YAAY,CAACc,KAAK,CAAC,CAAA;AACnB,QAAA,OAAA;AACJ,OAAA;AAEA,MAAA,IAAIb,OAAO,EAAE;AACTA,QAAAA,OAAO,EAAE,CAAA;AACb,OAAA;AACJ,KAAA;AACJ,GAAC,EACD,CAACA,OAAO,EAAED,YAAY,EAAEI,eAAe,CAACa,KAAK,EAAEd,UAAU,CAC7D,CAAC,CAAA;AAEDe,EAAAA,SAAS,CAAC,YAAM;AACZC,IAAAA,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAER,SAAS,CAAC,CAAA;AAC7C,IAAA,OAAO,YAAM;AACTO,MAAAA,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAET,SAAS,CAAC,CAAA;KACnD,CAAA;AACL,GAAC,EAAE,CAACX,OAAO,EAAED,YAAY,EAAEI,eAAe,CAACa,KAAK,EAAEd,UAAU,CAAC,CAAC,CAAA;;AAE9D;AACAe,EAAAA,SAAS,CAAC,YAAM;AACZ,IAAA,IAAIpB,MAAM,EAAE;MACRQ,QAAQ,CAACgB,OAAO,GAAGd,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,CAAA;AAChDH,MAAAA,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,GAAG,QAAQ,CAAA;AAC5C,KAAA;AACJ,GAAC,EAAE,CAACb,MAAM,CAAC,CAAC,CAAA;AAEZoB,EAAAA,SAAS,CAAC,YAAM;IACZ,IAAI,CAACpB,MAAM,IAAI,CAACyB,SAAS,CAACnB,eAAe,CAACa,KAAK,CAAC,EAAE;MAC9CT,QAAQ,CAACC,IAAI,CAACC,KAAK,CAACC,SAAS,GAAGL,QAAQ,CAACgB,OAAO,CAAA;AACpD,KAAA;AACJ,GAAC,EAAE,CAACxB,MAAM,EAAEQ,QAAQ,CAACgB,OAAO,EAAElB,eAAe,CAACa,KAAK,CAAC,CAAC,CAAA;EAErD,IAAMO,SAAoB,GAAAC,cAAA,CAAA;AACtB5B,IAAAA,EAAE,EAAFA,EAAE;AACF6B,IAAAA,IAAI,EAAE;AACFC,MAAAA,OAAO,EAAE,IAAA;AACb,KAAA;AAAC,GAAA,EACE5B,SAAS,CACf,CAAA;EAED,OAAO;AAAEyB,IAAAA,SAAS,EAATA,SAAAA;GAAW,CAAA;AACxB;;;;"}